name: Atualiza√ß√£o Di√°ria (Rob√¥s)

on:
  schedule:
    - cron: '0 6 * * *' # 03:00 Brasil
  workflow_dispatch:

jobs:
  executar-robos:
    runs-on: ubuntu-latest

    steps:
      - name: Baixar o c√≥digo (Checkout)
        uses: actions/checkout@v3

      - name: Instalar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Instalar Depend√™ncias
        run: |
          pip install -r requirements.txt
          pip install python-dotenv

      # üëá AQUI EST√Å A M√ÅGICA PARA CONSERTAR O ERRO üëá
      - name: Criar arquivo .env com Segredos
        run: |
          echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> .env
          echo "SUPABASE_KEY=${{ secrets.SUPABASE_KEY }}" >> .env
          echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> .env
          
          echo "RD_TOKEN=${{ secrets.RD_TOKEN }}" >> .env
          
          echo "LUMI_BASE_URL=${{ secrets.LUMI_BASE_URL }}" >> .env
          echo "LUMI_EMAIL=${{ secrets.LUMI_EMAIL }}" >> .env
          echo "LUMI_SENHA=${{ secrets.LUMI_SENHA }}" >> .env
          echo "LUMI_COOP_EMAIL=${{ secrets.LUMI_COOP_EMAIL }}" >> .env
          echo "LUMI_COOP_SENHA=${{ secrets.LUMI_COOP_SENHA }}" >> .env
          
          echo "UNIFICA_BASE_URL=${{ secrets.UNIFICA_BASE_URL }}" >> .env
          echo "UNIFICA_TOKEN=${{ secrets.UNIFICA_TOKEN }}" >> .env

      # Como o arquivo .env agora existe, n√£o precisamos passar 'env' em cada passo
      - name: Rodar Lumi Service
        run: python services/lumi_service.py

      - name: Rodar Unifica Service
        run: python services/unifica_service.py

      - name: Rodar RD Service
        run: python services/rd_service.py